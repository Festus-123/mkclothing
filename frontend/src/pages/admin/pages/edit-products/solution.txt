// GET PRODUCT BY ID
export const getProductById = createAsyncThunk(
  "products/getById",
  async (id, { rejectWithValue }) => {
    try {
      const data = await getProductsByIdApi(id);
      return data.product; // backend must return {product: {...}}
    } catch (err) {
      return rejectWithValue(err.message);
    }
  }
);

// UPDATE PRODUCT
export const updateProduct = createAsyncThunk(
  "products/update",
  async ({ id, formData }, { rejectWithValue }) => {
    try {
      const data = await updateProductApi(id, formData);
      return data.product; // backend returns updated product
    } catch (err) {
      return rejectWithValue(err.message);
    }
  }
);


builder
  // ---- GET PRODUCT BY ID ----
  .addCase(getProductById.pending, (state) => {
    state.loading = true;
    state.error = null;
  })
  .addCase(getProductById.fulfilled, (state, action) => {
    state.loading = false;
    state.product = action.payload;
  })
  .addCase(getProductById.rejected, (state, action) => {
    state.loading = false;
    state.error = action.payload;
  })

  // ---- UPDATE PRODUCT ----
  .addCase(updateProduct.pending, (state) => {
    state.loading = true;
    state.error = null;
  })
  .addCase(updateProduct.fulfilled, (state, action) => {
    state.loading = false;
    state.success = true;

    // Update the item in products[]
    const index = state.products.findIndex(
      (p) => p._id === action.payload._id
    );
    if (index !== -1) {
      state.products[index] = action.payload;
    }
  })
  .addCase(updateProduct.rejected, (state, action) => {
    state.loading = false;
    state.error = action.payload;
  });


